<link rel="import" href="../bower_components/polymer/polymer-element.html" />
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html" />
<link rel="import" href="../bower_components/paper-input/paper-textarea.html" />
<link rel="import" href="../bower_components/paper-item/paper-item.html" />
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html" />
<link rel="import" href="../bower_components/paper-item/paper-item.html" />
<link rel="import" href="../bower_components/iron-icon/iron-icon.html" />
<link rel="import" href="../bower_components/iron-icons/iron-icons.html" />
<link rel="import" href="existdb-fetch-labels.html" />

<dom-module id="existdb-annotation-item">
  <template>
    <style>
      :host {
        font-family: sans-serif;
        font-size: 0.8rem;
        text-align: left;
      }

      paper-item {
        /*padding: 0 4px;*/
        margin: 4px;
        background: white;
      }

      paper-button {
        background: black;
      }

      paper-listbox {
        width: 100%;
        background: var(--paper-blue-300);
      }

      app-toolbar {
        background: var(--paper-grey-300);
        font-size: 16px;
      }

      .type {
        font-weight: 500;
        padding: 12px;
        background-color: var(--paper-blue-500);
        color: white;
        font-size: 16px;
      }

      .item-body {
        padding: 10px;
        background: var(--paper-blue-300);
      }

      [hidden] {
        display: none;
      }
    </style>

    <div class="item">
      <div class="type">[[id]]</div>
      <div class="item-body">
        <existdb-fetch-labels selected="{{body.name}}" id="labels" labels="{{labels}}" on-label-selected="_setLabel" ></existdb-fetch-labels>
      </div>
    </div>
  </template>

  <script>
    /**
     * `existdb-annotation-item`
     *
     * @customElement
     * @polymer
     * @demo demo/existdb-annotation-item.html
     */
    class ExistdbAnnotationItem extends Polymer.Element {
      static get is() {
        return "existdb-annotation-item";
      }

      static get properties() {
        return {
          id: {
            type: String,
            value: ""
          },
          selected: {
            type: String,
            value: ""
          },
          body: {
            type: Object,
            value: _ => ({})
          },
          target: {
            type: Array,
            value: _ => []
          },
          labels: {
            type: Array,
            value: _ => [],
            reflectToAttribute: true,
            notify: true
          }
        };
      }

      connectedCallback() {
        super.connectedCallback();
      }

      ready() {
        super.ready();
      }

      _elementCount(property) {
        return this.get([property, "length"]);
      }

      highlight() {
        this.target
          .map(target => {
            const id = target.id;
            return new CustomEvent("highlight-target", {
              bubbles: true,
              composed: true,
              detail: { id: id }
            });
          })
          .forEach(event => this.dispatchEvent(event));
      }

      _setLabel(e) {
        console.log(e.detail.label)
        this.set('body', e.detail.label);
        this.dispatchEvent(
          new CustomEvent("annotation-changed", {
            bubbles: true,
            composed: true,
            detail: { id: this.id, body: this.body, target: this.target }
          })
        );
      }
    }

    window.customElements.define(ExistdbAnnotationItem.is, ExistdbAnnotationItem);
  </script>
</dom-module>
